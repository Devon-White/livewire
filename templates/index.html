<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - LiveWire SignalWire Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    {% include '_navbar.html' %}
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="sw-glass p-5 rounded shadow-lg">
                    <h1 class="sw-gradient-text mb-4">Welcome to LiveWire SignalWire Demo</h1>
                    <p class="mb-4">Enter your SignalWire credentials to get started. These are stored only for your session.</p>
                    <form id="stage1" autocomplete="off">
                        <div class="mb-3">
                            <label class="form-label">SignalWire Project ID</label>
                            <input type="text" name="project_id" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">SignalWire Auth Token</label>
                            <input type="password" name="auth_token" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">SignalWire Space Name</label>
                            <input type="text" name="space_name" class="form-control" required>
                        </div>
                        <button type="submit" class="demo-button w-100 mt-3">Get Started</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
    document.getElementById('stage1').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      // Store credentials in session via POST to /
      const resp = await fetch('/', {
        method: 'POST',
        body: data
      });

      if (resp.redirected) {
        // Now create/update the SWML handler
        const handlerResp = await fetch('/api/swml_handler', { method: 'POST' });
        if (handlerResp.ok) {
          // Now get widget config (guest token + destination)
          const configResp = await fetch('/api/widget_config', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({})
          });
          if (configResp.ok) {
            const config = await configResp.json();
            sessionStorage.setItem('widgetConfig', JSON.stringify(config));
            window.location.href = '/call';
          } else {
            const err = await configResp.json();
            alert('Failed to get widget config: ' + (err.error || configResp.status));
          }
        } else {
          const err = await handlerResp.json();
          alert('Failed to create SWML handler: ' + (err.error || handlerResp.status));
        }
      } else {
        alert('Failed to store credentials.');
      }
    });
    </script>
</body>
</html> 